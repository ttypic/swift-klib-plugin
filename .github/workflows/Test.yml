name: Test

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

permissions:
    contents: write

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    test:
        strategy:
            fail-fast: false
            matrix:
                os: [macos-latest, ubuntu-latest]
        runs-on: ${{ matrix.os }}
        if: github.repository == 'ttypic/swift-klib-plugin'
        timeout-minutes: 25

        steps:
            - uses: actions/checkout@v4
            - uses: gradle/wrapper-validation-action@v2
            - uses: actions/setup-java@v4
              with:
                  distribution: 'zulu'
                  java-version: '17'
                  check-latest: true

            - name: Run tests
              run: ./gradlew test functionalTest
